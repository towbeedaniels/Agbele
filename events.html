<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Events · Agbele Footballers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
      <div class="container">
        <a class="navbar-brand brand-text" href="index.html">Agbele Footballers</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="news.html">News</a></li>
            <li class="nav-item"><a class="nav-link" href="events.html">Events</a></li>
            <li class="nav-item"><a class="nav-link" href="directory.html">Members</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-4 py-lg-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h3 mb-0">Events Calendar</h1>
        <button class="btn btn-brand" data-bs-toggle="modal" data-bs-target="#eventModal"><i class="bi bi-plus-lg me-2"></i>Add Event</button>
      </div>

      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="btn-group" role="group">
          <button class="btn btn-outline-secondary" id="prev-month">Prev</button>
          <button class="btn btn-outline-secondary" id="today">Today</button>
          <button class="btn btn-outline-secondary" id="next-month">Next</button>
        </div>
        <h2 class="h5 mb-0" id="month-label">Month YYYY</h2>
      </div>

      <div class="row g-0" id="calendar-grid"></div>
    </main>

    <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" id="event-form">
          <div class="modal-header">
            <h5 class="modal-title">Create Event</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label required">Title</label>
              <input type="text" class="form-control" id="event-title" required>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label required">Date</label>
                <input type="date" class="form-control" id="event-date" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Time</label>
                <input type="time" class="form-control" id="event-time">
              </div>
            </div>
            <div class="mb-3 mt-3">
              <label class="form-label">Location</label>
              <input type="text" class="form-control" id="event-location" placeholder="e.g., Community Center">
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" id="event-description" rows="4"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-brand">Save</button>
          </div>
        </form>
      </div>
    </div>

    <footer class="footer py-4 mt-5">
      <div class="container d-flex flex-column flex-lg-row align-items-center justify-content-between">
        <p class="mb-2 mb-lg-0 text-muted">© <span id="year"></span> Agbele Footballers.</p>
        <div class="small text-muted">Built with Bootstrap 5</div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="assets/js/common.js"></script>
    <script type="module" src="assets/js/data.js"></script>
    <script type="module">
      import { STORAGE_KEYS, getItems, saveItems } from './assets/js/storage.js';

      const grid = document.getElementById('calendar-grid');
      const monthLabel = document.getElementById('month-label');
      let current = new Date();

      function getMonthMatrix(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const first = new Date(year, month, 1);
        const last = new Date(year, month + 1, 0);
        const startDay = first.getDay();
        const totalDays = last.getDate();
        const cells = [];
        for (let i = 0; i < startDay; i++) cells.push(null);
        for (let d = 1; d <= totalDays; d++) cells.push(new Date(year, month, d));
        while (cells.length % 7 !== 0) cells.push(null);
        return cells;
      }

      function render() {
        const y = current.getFullYear();
        const m = current.getMonth();
        monthLabel.textContent = new Intl.DateTimeFormat(undefined, { month: 'long', year: 'numeric' }).format(current);
        const cells = getMonthMatrix(current);
        const events = getItems(STORAGE_KEYS.events);

        grid.innerHTML = '';
        cells.forEach((cellDate) => {
          const col = document.createElement('div');
          col.className = 'col-12 col-md-6 col-lg-4 border calendar-day';
          if (!cellDate) {
            col.classList.add('bg-light');
            grid.appendChild(col);
            return;
          }
          const dateStr = cellDate.toISOString().slice(0,10);
          const dayEvents = events.filter(e => e.date === dateStr);
          if (dayEvents.length) col.classList.add('has-event');
          col.innerHTML = `
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="date-number">${cellDate.getDate()}</span>
              <button class="btn btn-sm btn-outline-secondary" data-date="${dateStr}" data-action="add">Add</button>
            </div>
            <div>
              ${dayEvents.map(e => `<div class="small mb-1"><span class="badge rounded-pill badge-brand me-2">${e.time || ''}</span>${e.title}</div>`).join('')}
            </div>
          `;
          grid.appendChild(col);
        });
      }

      document.getElementById('prev-month').addEventListener('click', () => { current.setMonth(current.getMonth() - 1); render(); });
      document.getElementById('next-month').addEventListener('click', () => { current.setMonth(current.getMonth() + 1); render(); });
      document.getElementById('today').addEventListener('click', () => { current = new Date(); render(); });

      grid.addEventListener('click', (e) => {
        const btn = e.target.closest('[data-action="add"]');
        if (!btn) return;
        const date = btn.getAttribute('data-date');
        const modal = new bootstrap.Modal(document.getElementById('eventModal'));
        document.getElementById('event-date').value = date;
        modal.show();
      });

      const form = document.getElementById('event-form');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const item = {
          id: crypto.randomUUID(),
          title: document.getElementById('event-title').value.trim(),
          date: document.getElementById('event-date').value,
          time: document.getElementById('event-time').value,
          location: document.getElementById('event-location').value.trim(),
          description: document.getElementById('event-description').value.trim(),
        };
        const items = getItems(STORAGE_KEYS.events);
        items.push(item);
        saveItems(STORAGE_KEYS.events, items);
        bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
        form.reset();
        render();
      });

      document.getElementById('year').textContent = new Date().getFullYear();
      render();
    </script>
  </body>
  </html>


